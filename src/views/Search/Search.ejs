<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K·∫øt qu·∫£ t√¨m ki·∫øm - SweetHome</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
   <!-- css -->
  <link rel="stylesheet" href="/stylesSearch.css" />
  <style>
    .card-img-top {
      max-height: 200px;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
    <nav
      class="navbar navbar-expand-lg navbar-light bg-light"
      style="
        width: 100%;
        opacity: 80%;
        position: fixed;
        z-index: 1000;
        top: 0;
        left: 0;
      "
    >
      <!-- Logo b√™n tr√°i -->
      <a class="navbar-brand" href="/">
        <img
          src="./image/image/logo/logo.jpg"
          alt="Logo"
          style="
            margin: 0px;
            padding: 0px;
            width: 100px;
            height: 100px;
            position: absolute;
            margin-top: -50px;
            margin-left: 70px;
          "
          class="logo"
        />
      </a>
      <div class="container kt">
        <!-- N√∫t Toggle khi m√†n h√¨nh nh·ªè -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Danh m·ª•c menu (CƒÉn gi·ªØa) -->
        <div
          class="collapse navbar-collapse justify-content-center"
          id="navbarNav"
          style="margin-left: 100px"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="/" style="font-weight: bold"
                >TRANG CH·ª¶</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#intro" style="font-weight: bold"
                >GI·ªöI THI·ªÜU</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#CH" style="font-weight: bold"
                >CƒÇN H·ªò</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#LH" style="font-weight: bold"
                >LI√äN H·ªÜ</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#DG" style="font-weight: bold"
                >ƒê√ÅNH GI√Å</a
              >
            </li>
          </ul>
        </div>

        <!-- N√∫t ƒêƒÉng nh·∫≠p/ƒêƒÉng xu·∫•t (B√™n ph·∫£i) -->
        <% if (user) { %>
        <div class="dropdown">
          <button
            class="btn p-0 border-0 bg-transparent"
            type="button"
            id="userDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <img
              src="https://i.postimg.cc/rF3Fh10Y/avatar-trang-4.jpg"
              alt="Avatar"
              class="rounded-circle"
              width="40"
              height="40"
            />
          </button>
          <ul
            class="dropdown-menu dropdown-menu-end shadow"
            aria-labelledby="userDropdown"
          >
            <li>
              <span class="dropdown-item text-primary fw-bold">
                <%= user.email %>
              </span>
            </li>
            <li>
              <a class="dropdown-item" href="/account">Th√¥ng tin t√†i kho·∫£n</a>
            </li>
            <li>
              <a class="dropdown-item" href="/bookings">L·ªãch s·ª≠ ƒë·∫∑t ph√≤ng</a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a class="dropdown-item text-danger" href="/logout">ƒêƒÉng xu·∫•t</a>
            </li>
          </ul>
        </div>
        <% } else { %>
        <button class="btn btn-primary" onclick="window.location.href='/login'">
          ƒêƒÇNG NH·∫¨P
        </button>
        <% } %>
      </div>
    </nav>

  <form action="/search" method="get" class="search-box">
    <div class="m-2">
      <label for="checkin" class="form-label" style="color: #707070; font-size: 18px">Ng√†y nh·∫≠n</label>
      <input type="date" class="form-control" id="checkin" name="checkin" value="<%= checkin %>" />
    </div>
    <div class="m-2">
      <label for="checkout" class="form-label" style="color: #707070; font-size: 18px">Ng√†y tr·∫£</label>
      <input type="date" class="form-control" id="checkout" name="checkout" value="<%= checkout %>" />
    </div>
    <div class="m-2">
      <label for="adults" class="form-label" style="color: #707070; font-size: 18px">Ng∆∞·ªùi l·ªõn</label>
      <input type="number" class="form-control" id="adults" name="adults" value="<%= adults %>" />
    </div>
    <div class="m-2">
      <label for="children" class="form-label" style="color: #707070; font-size: 18px">Tr·∫ª em</label>
      <input type="number" class="form-control" id="children" name="children" value="<%= children %>" />
    </div>
    <div class="m-2 align-self-end">
      <button type="submit" class="btn btn-dark">T√¨m</button>
    </div>
  </form>

  <div class="container py-4">
  <div class="row">
    <!-- B·ªô l·ªçc b√™n tr√°i -->
   <div class="col-md-3">
  <h5 class="mb-3">B·ªô l·ªçc</h5>
  <form id="filterForm" method="get" action="/search">
    <input type="hidden" name="checkin" value="<%= checkin %>">
    <input type="hidden" name="checkout" value="<%= checkout %>">
    <input type="hidden" name="adults" value="<%= adults %>">
    <input type="hidden" name="children" value="<%= children %>">

    <div class="mb-3">
      <label class="form-label">Ph∆∞·ªùng</label>
      <select class="form-select" name="ward">
        <option value="" <%= ward === "" ? "selected" : "" %>>T·∫•t c·∫£</option>
        <option value="Ph∆∞·ªùng 1" <%= ward === "Ph∆∞·ªùng 1" ? "selected" : "" %>>Ph∆∞·ªùng 1</option>
        <option value="Ph∆∞·ªùng 2" <%= ward === "Ph∆∞·ªùng 2" ? "selected" : "" %>>Ph∆∞·ªùng 2</option>
        <option value="Ph∆∞·ªùng 5" <%= ward === "Ph∆∞·ªùng 5" ? "selected" : "" %>>Ph∆∞·ªùng 5</option>
        <option value="Ph∆∞·ªùng Th·∫Øng Tam" <%= ward === "Ph∆∞·ªùng Th·∫Øng Tam" ? "selected" : "" %>>Ph∆∞·ªùng Th·∫Øng Tam</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Kho·∫£ng gi√°</label>
      <select class="form-select" name="price">
        <option value="" <%= price === "" ? "selected" : "" %>>T·∫•t c·∫£</option>
        <option value="1" <%= price === "1" ? "selected" : "" %>>D∆∞·ªõi 500k</option>
        <option value="2" <%= price === "2" ? "selected" : "" %>>500k - 1 tri·ªáu</option>
        <option value="3" <%= price === "3" ? "selected" : "" %>>Tr√™n 1 tri·ªáu</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">D·ªãch v·ª•</label>
      <select class="form-select" name="service">
        <option value="" <%= service === "" ? "selected" : "" %>>T·∫•t c·∫£</option>
        <option value="Wi-Fi mi·ªÖn ph√≠" <%= service === "Wi-Fi mi·ªÖn ph√≠" ? "selected" : "" %>>Wi-Fi mi·ªÖn ph√≠</option>
        <option value="ƒêi·ªÅu h√≤a" <%= service === "ƒêi·ªÅu h√≤a" ? "selected" : "" %>>ƒêi·ªÅu h√≤a</option>
        <option value="H·ªì b∆°i" <%= service === "H·ªì b∆°i" ? "selected" : "" %>>H·ªì b∆°i</option>
        <option value="B√£i ƒë·ªó xe" <%= service === "B√£i ƒë·ªó xe" ? "selected" : "" %>>B√£i ƒë·ªó xe</option>
        <option value="B·ªØa s√°ng mi·ªÖn ph√≠" <%= service === "B·ªØa s√°ng mi·ªÖn ph√≠" ? "selected" : "" %>>B·ªØa s√°ng mi·ªÖn ph√≠</option>
        <option value="TV m√†n h√¨nh ph·∫≥ng" <%= service === "TV m√†n h√¨nh ph·∫≥ng" ? "selected" : "" %>>TV m√†n h√¨nh ph·∫≥ng</option>
        <option value="M√°y n∆∞·ªõc n√≥ng" <%= service === "M√°y n∆∞·ªõc n√≥ng" ? "selected" : "" %>>M√°y n∆∞·ªõc n√≥ng</option>
        <option value="Gi·∫∑t ·ªßi" <%= service === "Gi·∫∑t ·ªßi" ? "selected" : "" %>>Gi·∫∑t ·ªßi</option>
        <option value="Ph√≤ng Gym" <%= service === "Ph√≤ng Gym" ? "selected" : "" %>>Ph√≤ng Gym</option>
        <option value="D·ªãch v·ª• ƒë∆∞a ƒë√≥n s√¢n bay" <%= service === "D·ªãch v·ª• ƒë∆∞a ƒë√≥n s√¢n bay" ? "selected" : "" %>>D·ªãch v·ª• ƒë∆∞a ƒë√≥n s√¢n bay</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Lo·∫°i ch·ªó ·ªü</label>
      <select class="form-select" name="type">
        <option value="" <%= type === "" ? "selected" : "" %>>T·∫•t c·∫£</option>
        <option value="house" <%= type === "house" ? "selected" : "" %>>Nh√† nguy√™n cƒÉn</option>
        <option value="apartment" <%= type === "apartment" ? "selected" : "" %>>Ph√≤ng trong cƒÉn h·ªô</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">S·∫Øp x·∫øp theo</label>
      <select class="form-select" name="sort">
        <option value="" <%= sort === "" ? "selected" : "" %>>M·∫∑c ƒë·ªãnh</option>
        <option value="asc" <%= sort === "asc" ? "selected" : "" %>>Gi√° tƒÉng d·∫ßn</option>
        <option value="desc" <%= sort === "desc" ? "selected" : "" %>>Gi√° gi·∫£m d·∫ßn</option>
      </select>
    </div>

    <div class="d-grid">
      <button type="submit" class="btn" style="background-color: black; color: white ;">√Åp d·ª•ng</button>
    </div>
  </form>
</div>


    <!-- K·∫øt qu·∫£ b√™n ph·∫£i -->
<!-- K·∫øt qu·∫£ b√™n ph·∫£i - CH·ªà B·ªé TH√îNG B√ÅO "C√ì S·∫¥N SAU" -->
<div class="col-md-9" id="roomResults">
  <h5 class="text-muted mb-4">
    K·∫øt qu·∫£ t√¨m ki·∫øm cho: <%= checkin %> ‚Üí <%= checkout %> | <%= adults %> ng∆∞·ªùi l·ªõn, <%= children %> tr·∫ª em
  </h5>

  <div class="row">
    <div class="col-12">
      <div class="row mt-3">
        <% if (rooms.length === 0) { %>
          <p>Kh√¥ng t√¨m th·∫•y ph√≤ng ph√π h·ª£p.</p>
        <% } %>

        <% rooms.forEach(room => { %>
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 d-flex flex-column shadow-sm border-0" style="transition: 0.3s;">
              <img src="<%= room.thumbnail %>" class="card-img-top" alt="<%= room.name %>" style="height: 180px; object-fit: cover;">

              <div class="card-body d-flex flex-column">
                <h5 class="card-title mb-2 fw-semibold"><%= room.name %></h5>

                <% if (room.price < 500000) { %>
                  <span class="badge rounded-pill mb-1 px-3 py-1 text-white" style="background-color: #28a745;">üåº Ti·∫øt ki·ªám</span>
                <% } %>
                <% if (room.avg_rating && room.avg_rating >= 4.5) { %>
                  <span class="badge rounded-pill mb-2 px-3 py-1 text-white" style="background-color: #dc3545;">üî• Y√™u th√≠ch</span>
                <% } %>

                <% if (room.avg_rating) { %>
                  <p class="text-warning mb-2">
                    ‚≠ê <%= room.avg_rating %>/5
                    <span class="text-muted">(<%= room.review_count %> ƒë√°nh gi√°)</span>
                  </p>
                <% } %>

                <!-- B·ªé PH·∫¶N TH√îNG B√ÅO "C√ì S·∫¥N SAU" -->

                <p class="card-text flex-grow-1" style="font-size: 0.95rem;">
                  <strong>M√¥ t·∫£:</strong>
                  <% if (room.description?.toLowerCase().includes("nh√† nguy√™n cƒÉn")) { %>
                    Nh√† nguy√™n cƒÉn
                  <% } else if (room.description?.toLowerCase().includes("ph√≤ng ri√™ng trong cƒÉn h·ªô")) { %>
                    Ph√≤ng ri√™ng trong cƒÉn h·ªô
                  <% } else { %>
                    Kh√¥ng x√°c ƒë·ªãnh
                  <% } %>
                  <br>

                  <strong>Gi√°:</strong>
                  <!-- ƒê·ªîI M√ÄU GI√Å TH√ÄNH ƒê·ªé -->
                  <span class="price-tag" style="color: #e74c3c; font-weight: bold; font-size: 1.1rem;">
                    <%= Number(room.price).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) %>
                  </span>
                  <small class="text-muted"> / ƒë√™m</small><br>
                  
                  <strong>ƒê·ªãa ch·ªâ:</strong> <%= room.address %><br>

                  <strong>D·ªãch v·ª•:</strong>
                  <% if (room.services?.length) { %>
                    <% room.services.forEach(service => { %>
                      <span class="service-badge d-inline-block"><%= service %></span>
                    <% }) %>
                  <% } else { %>
                    <span class="text-muted">Kh√¥ng c√≥</span>
                  <% } %>

                </p>

                <a href="/room/<%= room.room_type_id %>" class="btn mt-auto px-3 py-2 fw-semibold"
                   style="background-color: #a59a81; color: white; border-radius: 30px; transition: 0.2s;">
                  Xem chi ti·∫øt
                </a>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>
</div>
</div>
  </div>

  <!-- Footer -->
   <footer class="bg-light py-4" style="width: 1520px" id="LH">
      <div class="container" style="margin-top: 20px">
        <div class="row">
          <!-- C·ªôt Li√™n H·ªá -->
          <div class="col-md-4">
            <h5 class="fw-bold">LI√äN H·ªÜ CH√öNG T√îI</h5>
            <p><i class="fas fa-envelope"></i> Email: 23521265@gm.uit.edu.vn</p>
            <p><i class="fas fa-phone"></i> S·ªë ƒëi·ªán tho·∫°i: 080-678-963-210</p>
            <p>
              <i class="fas fa-map-marker-alt"></i> ƒê·ªãa ch·ªâ: 183B/19, qu·∫≠n Cam,
              th√†nh ph·ªë S√†i G√≤n
            </p>
          </div>

          <!-- C·ªôt M·∫°ng X√£ H·ªôi -->
          <div class="col-md-4 text-left">
            <h5 class="fw-bold">M·∫†NG X√É H·ªòI</h5>
            <a
              href="https://www.instagram.com"
              target="_blank"
              class="d-block text-decoration-none text-dark mb-2"
            >
              <i class="fab fa-instagram"></i> Instagram
            </a>
            <a
              href="https://www.facebook.com"
              target="_blank"
              class="d-block text-decoration-none text-dark mb-2"
            >
              <i class="fab fa-facebook"></i> Facebook
            </a>
            <a
              href="https://www.youtube.com"
              target="_blank"
              class="d-block text-decoration-none text-dark mb-2"
            >
              <i class="fab fa-youtube"></i> Youtube
            </a>
            <a
              href="https://www.twitter.com"
              target="_blank"
              class="d-block text-decoration-none text-dark mb-2"
            >
              <i class="fab fa-twitter"></i> Twitter
            </a>
          </div>

          <!-- C·ªôt B·∫£n ƒê·ªì -->
          <div class="col-md-4">
            <h5 class="fw-bold">MAPS</h5>
            <iframe
              src="https://www.google.com/maps?q=V≈©ng+T√†u&output=embed"
              width="100%"
              height="150"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
            >
            </iframe>
          </div>
        </div>
      </div>
    </footer>
  <div class="text-center mt-3">
    <p class="mb-0">¬© 2025 - All Rights Reserved</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script>
    document.getElementById("checkin").value = "<%= checkin %>";
    document.getElementById("checkout").value = "<%= checkout %>";
    document.getElementById("adults").value = "<%= adults || '2' %>";
    document.getElementById("children").value = "<%= children || '0' %>";
  </script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("filterForm"); // <- nh·ªõ form ph·∫£i c√≥ id="filterForm"
    const resultDiv = document.getElementById("roomResults");

    form.addEventListener("submit", async function (e) {
      e.preventDefault(); // NgƒÉn form reload

      const formData = new FormData(form);
      const params = new URLSearchParams(formData);

      try {
        const res = await fetch(`/search/ajax?${params}`);
        const html = await res.text();
        resultDiv.innerHTML = html;

        // ‚úÖ C·∫≠p nh·∫≠t URL cho ƒë·∫πp
        history.pushState(null, '', `/search?${params}`);
      } catch (err) {
        console.error("Fetch error:", err);
        resultDiv.innerHTML = "<p class='text-danger'>Kh√¥ng th·ªÉ t·∫£i k·∫øt qu·∫£.</p>";
      }
    });
  });
</script>

</body>
</html>